<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="generator" content="quarto-1.2.269">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">
<title>Spatial Analysis and Statistical Modeling with R and spmodel - 3&nbsp; Spatial Generalized Linear Models in spmodel</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1.6em;
  vertical-align: middle;
}
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
}
.hanging div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}
</style>

<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./gis-in-r.html" rel="next">
<link href="./splm-additional.html" rel="prev">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light"><script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit"
  }
}</script><script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>
</head>
<body class="nav-sidebar floating">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top"><nav class="quarto-secondary-nav" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }"><div class="container-fluid d-flex justify-content-between">
      <h1 class="quarto-secondary-nav-title"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Spatial Generalized Linear Models in <code>spmodel</code></span></h1>
      <button type="button" class="quarto-btn-toggle btn" aria-label="Show secondary navigation">
        <i class="bi bi-chevron-right"></i>
      </button>
    </div>
  </nav></header><!-- content --><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse sidebar-navigation floating overflow-auto"><div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="./">Spatial Analysis and Statistical Modeling with R and spmodel</a> 
    </div>
      </div>
      <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
      </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">Welcome</a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./splm.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Spatial Linear Models in <code>spmodel</code></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./splm-additional.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Additional <code>spmodel</code> Features</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./spglm.html" class="sidebar-item-text sidebar-link active"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Spatial Generalized Linear Models in <code>spmodel</code></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./gis-in-r.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">GIS in R</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./watershed-delineation.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Watershed Delineation in <code>R</code></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./streamcattools.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">StreamCat &amp; LakeCat</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./spatial-glm.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Spatial GLM of “Dancer” damselfly (<em>Argia</em>)</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./references.html" class="sidebar-item-text sidebar-link">References</a>
  </div>
</li>
    </ul>
</div>
</nav><!-- margin-sidebar --><div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active"><h2 id="toc-title">Table of contents</h2>
   
  <ul>
<li><a href="#the-spatial-generalized-linear-model" id="toc-the-spatial-generalized-linear-model" class="nav-link active" data-scroll-target="#the-spatial-generalized-linear-model"><span class="toc-section-number">3.1</span>  The Spatial Generalized Linear Model</a></li>
  <li><a href="#model-fitting" id="toc-model-fitting" class="nav-link" data-scroll-target="#model-fitting"><span class="toc-section-number">3.2</span>  Model Fitting</a></li>
  <li><a href="#spatial-prediction" id="toc-spatial-prediction" class="nav-link" data-scroll-target="#spatial-prediction"><span class="toc-section-number">3.3</span>  Spatial Prediction</a></li>
  <li><a href="#additional-spmodel-features" id="toc-additional-spmodel-features" class="nav-link" data-scroll-target="#additional-spmodel-features"><span class="toc-section-number">3.4</span>  Additional <code>spmodel</code> Features</a></li>
  <li><a href="#spatial-generalized-autoregressive-mdoels" id="toc-spatial-generalized-autoregressive-mdoels" class="nav-link" data-scroll-target="#spatial-generalized-autoregressive-mdoels"><span class="toc-section-number">3.5</span>  Spatial Generalized Autoregressive Mdoels</a></li>
  <li><a href="#r-code-appendix" id="toc-r-code-appendix" class="nav-link" data-scroll-target="#r-code-appendix"><span class="toc-section-number">3.6</span>  R Code Appendix</a></li>
  </ul></nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content"><header id="title-block-header" class="quarto-title-block default"><div class="quarto-title">
<h1 class="title"><span id="sec-spglm" class="quarto-section-identifier d-none d-lg-block"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Spatial Generalized Linear Models in <code>spmodel</code></span></span></h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  

</header><div class="cell">

</div>
<p>Throughout this section, we will use the <code>spmodel</code> package and the <code>ggplot2</code> package:</p>
<div class="cell">
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://usepa.github.io/spmodel/">spmodel</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org">ggplot2</a></span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><strong>Goals</strong>:</p>
<ul>
<li>Explain how modeling spatial covariance fits within the structure of a generalized linear model.</li>
<li>Use the <code><a href="https://usepa.github.io/spmodel/reference/spglm.html">spglm()</a></code> and <code><a href="https://usepa.github.io/spmodel/reference/spgautor.html">spgautor()</a></code> functions in <code>spmodel</code> to fit generalized linear models for various model families (i.e., response distributions).</li>
<li>Discuss how the additional <code>spmodel</code> features from the previous section apply to spatial generalized linear models.</li>
</ul>
<section id="the-spatial-generalized-linear-model" class="level2" data-number="3.1"><h2 data-number="3.1" class="anchored" data-anchor-id="the-spatial-generalized-linear-model">
<span class="header-section-number">3.1</span> The Spatial Generalized Linear Model</h2>
<p>As with spatial linear models, spatial generalized linear models can be fit in <code>spmodel</code> for point-referenced and areal data. A generalized linear model essentially uses the right-hand-side of <a href="splm.html#eq-splm">Equation&nbsp;<span>1.4</span></a> as a model for a function of the mean of the response vector <span class="math inline">\(\mathbf{y}\)</span>. More formally, the spatial generalized linear model can be written as <span class="math display">\[
g(\boldsymbol{\mu}) = \mathbf{X} \boldsymbol{\beta} + \boldsymbol{\tau} + \boldsymbol{\epsilon},
\]</span> where <span class="math inline">\(g(\boldsymbol{\mu})\)</span> is the link function that “links” a function of the mean of <span class="math inline">\(\mathbf{y}\)</span> to <span class="math inline">\(\mathbf{X} \boldsymbol{\beta}\)</span>, <span class="math inline">\(\boldsymbol{\tau}\)</span>, and <span class="math inline">\(\boldsymbol{\epsilon}\)</span>. For example, in a spatial Poisson generalized linear model, each element of <span class="math inline">\(\mathbf{y}\)</span>, <span class="math inline">\(\text{y}_i\)</span>, is modeled as a Poisson random variable with mean <span class="math inline">\(\mu_i\)</span>. Denoting the vector of means as <span class="math inline">\(\boldsymbol{\mu}\)</span>, the log of the mean vector of <span class="math inline">\(\mathbf{y}\)</span> is then modeled as</p>
<p><span class="math display">\[
\text{log}(\boldsymbol{\mu}) = \mathbf{X} \boldsymbol{\beta} + \boldsymbol{\tau} + \boldsymbol{\epsilon},
\]</span></p>
<p>where the <span class="math inline">\(\text{log()}\)</span> function is applied element-wise over the mean vector <span class="math inline">\(\boldsymbol{\mu}\)</span>, which is the expected value of <span class="math inline">\(\mathbf{y}\)</span>. In this example, the link function used is the log link. In the binomial generalized linear model family, a popular link function is the logit link, so that the model for the mean of a binomial response vector is</p>
<p><span class="math display">\[
\text{log}\left(\frac{\boldsymbol{\mu}}{1 - \boldsymbol{\mu}}\right) = \mathbf{X} \boldsymbol{\beta} + \boldsymbol{\tau} + \boldsymbol{\epsilon},
\]</span> <a href="#tbl-links">Table&nbsp;<span>3.1</span></a> shows the response distributions, data types, and link functions available in <code>spmodel</code>.</p>
<div id="tbl-links" class="anchored">
<table class="table">
<caption>Table&nbsp;3.1: Response distributions and link functions available in <code>spmodel</code>
</caption>
<thead><tr class="header">
<th>Distribution</th>
<th>Data Type</th>
<th>Link Function</th>
</tr></thead>
<tbody>
<tr class="odd">
<td>Poisson</td>
<td>Count</td>
<td>Log</td>
</tr>
<tr class="even">
<td>Negative Binomial</td>
<td>Count</td>
<td>Log</td>
</tr>
<tr class="odd">
<td>Binomial</td>
<td>Binary</td>
<td>Logit</td>
</tr>
<tr class="even">
<td>Beta</td>
<td>Proportion</td>
<td>Logit</td>
</tr>
<tr class="odd">
<td>Gamma</td>
<td>Skewed</td>
<td>Log</td>
</tr>
<tr class="even">
<td>Inverse Gaussian</td>
<td>Skewed</td>
<td>Log</td>
</tr>
</tbody>
</table>
</div>
</section><section id="model-fitting" class="level2" data-number="3.2"><h2 data-number="3.2" class="anchored" data-anchor-id="model-fitting">
<span class="header-section-number">3.2</span> Model Fitting</h2>
<p>The <code><a href="https://usepa.github.io/spmodel/reference/spglm.html">spglm()</a></code> function is used to fit spatial generalized linear models for point-referenced data, and the <code><a href="https://usepa.github.io/spmodel/reference/spgautor.html">spgautor()</a></code> function is used to fit spatial generalized linear models for areal data. <code><a href="https://usepa.github.io/spmodel/reference/spglm.html">spglm()</a></code> and <code><a href="https://usepa.github.io/spmodel/reference/spgautor.html">spgautor()</a></code> share similar syntax with <code><a href="https://usepa.github.io/spmodel/reference/splm.html">splm()</a></code> and <code><a href="https://usepa.github.io/spmodel/reference/spautor.html">spautor()</a></code>, respectively, though one additional argument is required:</p>
<ul>
<li>
<code>family</code>: The generalized linear model family (i.e., the distribution of <span class="math inline">\(\mathbf{y}\)</span>). The <code>family</code> argument can be <code>binomial</code>, <code>beta</code>, <code>Poisson</code>, <code>nbinomial</code>, <code>Gamma</code>, or <code>inverse.gaussian</code>.</li>
</ul>
<div class="callout-note callout callout-style-default callout-captioned">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<p>The <code>family</code> argument in <code><a href="https://usepa.github.io/spmodel/reference/spglm.html">spglm()</a></code> and <code><a href="https://usepa.github.io/spmodel/reference/spgautor.html">spgautor()</a></code> uses similar syntax as the <code>family</code> argument in <code><a href="https://rdrr.io/r/stats/glm.html">glm()</a></code>. One difference, however, is that the link function for the <code>spmodel</code> functions is fixed. For binomial and beta responses, that link is the logit link function, while for Poisson, negative binomial, gamma, and inverse gaussian responses, that link is the log link function.</p>
</div>
</div>
<p>While spatial generalized linear models can be fit to both point-referenced and areal data, we focus only on fitting spatial generalized linear models to point-referenced data with <code><a href="https://usepa.github.io/spmodel/reference/spglm.html">spglm()</a></code> for the remainder of this section. Models are fit using a novel application of the Laplace approximation – <span class="citation" data-cites="hoef2023marginal">Ver Hoef et al. (<a href="references.html#ref-hoef2023marginal" role="doc-biblioref">2023</a>)</span> provide further details.</p>
<p>We observed in <a href="splm.html#sec-sp-pred"><span>Section&nbsp;1.3</span></a> that a generalized linear model may be a better choice for the <code>count</code> data in the Alaska <code>moose</code>. We specify a Poisson spatial generalized linear model with the following:</p>
<div class="cell">
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">poismod</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://usepa.github.io/spmodel/reference/spglm.html">spglm</a></span><span class="op">(</span><span class="va">count</span> <span class="op">~</span> <span class="va">elev</span> <span class="op">*</span> <span class="va">strat</span>, data <span class="op">=</span> <span class="va">moose</span>,</span>
<span>               family <span class="op">=</span> <span class="va">poisson</span>, spcov_type <span class="op">=</span> <span class="st">"spherical"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">poismod</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Call:</span></span>
<span><span class="co">#&gt; spglm(formula = count ~ elev * strat, family = poisson, data = moose, </span></span>
<span><span class="co">#&gt;     spcov_type = "spherical")</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Deviance Residuals:</span></span>
<span><span class="co">#&gt;     Min      1Q  Median      3Q     Max </span></span>
<span><span class="co">#&gt; -1.4245 -0.7783 -0.3653  0.1531  0.5900 </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Coefficients (fixed):</span></span>
<span><span class="co">#&gt;              Estimate Std. Error z value Pr(&gt;|z|)    </span></span>
<span><span class="co">#&gt; (Intercept) -2.230575   0.958201  -2.328 0.019919 *  </span></span>
<span><span class="co">#&gt; elev         0.007623   0.003129   2.437 0.014820 *  </span></span>
<span><span class="co">#&gt; stratM       2.752234   0.782853   3.516 0.000439 ***</span></span>
<span><span class="co">#&gt; elev:stratM -0.010248   0.004472  -2.292 0.021928 *  </span></span>
<span><span class="co">#&gt; ---</span></span>
<span><span class="co">#&gt; Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Pseudo R-squared: 0.09573</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Coefficients (spherical spatial covariance):</span></span>
<span><span class="co">#&gt;        de        ie     range </span></span>
<span><span class="co">#&gt;     3.892     1.163 51204.657 </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Coefficients (Dispersion for poisson family):</span></span>
<span><span class="co">#&gt; dispersion </span></span>
<span><span class="co">#&gt;          1</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>As with spatial linear models, the broom functions <code><a href="https://generics.r-lib.org/reference/tidy.html">tidy()</a></code>, <code><a href="https://generics.r-lib.org/reference/glance.html">glance()</a></code> and <code><a href="https://generics.r-lib.org/reference/augment.html">augment()</a></code>, as well as many other generic functions like <code><a href="https://rdrr.io/r/graphics/plot.default.html">plot()</a></code>, are available for spatial generalized linear models. For example, we glance at the fitted model by running</p>
<div class="cell">
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://generics.r-lib.org/reference/glance.html">glance</a></span><span class="op">(</span><span class="va">poismod</span><span class="op">)</span></span>
<span><span class="co">#&gt; # A tibble: 1 × 9</span></span>
<span><span class="co">#&gt;       n     p  npar value   AIC  AICc logLik deviance pseudo.r.squared</span></span>
<span><span class="co">#&gt;   &lt;int&gt; &lt;dbl&gt; &lt;int&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;  &lt;dbl&gt;    &lt;dbl&gt;            &lt;dbl&gt;</span></span>
<span><span class="co">#&gt; 1   218     4     3 1332. 1338. 1338.  -666.     84.3           0.0957</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="callout-important callout callout-style-default no-icon callout-captioned">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
Exercise
</div>
</div>
<div class="callout-body-container callout-body">
<p>Fit a spatial negative binomial model to the <code>moose</code> data with <code>count</code> as the response and <code>elev</code>, <code>strat</code>, and their interaction as predictors. The negative binomial model relaxes the assumption in the spatial Poisson generalized linear model that the mean of a response variable <span class="math inline">\(\text{y}_i\)</span> and the variance of a response variable <span class="math inline">\(text{y}_i\)</span> must be equal. Obtain a summary of the fitted model. Then compare their fits using <code><a href="https://usepa.github.io/spmodel/reference/loocv.html">loocv()</a></code>. Which model is preferable based on the leave-one-out MSPE?</p>
</div>
</div>
<div class="callout-important callout callout-style-default no-icon callout-captioned">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-3-contents" aria-controls="callout-3" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
Exercise Solution
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-3" class="callout-3-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<div class="cell">
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">nbmod</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://usepa.github.io/spmodel/reference/spglm.html">spglm</a></span><span class="op">(</span><span class="va">count</span> <span class="op">~</span> <span class="va">elev</span> <span class="op">*</span> <span class="va">strat</span>, data <span class="op">=</span> <span class="va">moose</span>,</span>
<span>               family <span class="op">=</span> <span class="va">nbinomial</span>, spcov_type <span class="op">=</span> <span class="st">"spherical"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://usepa.github.io/spmodel/reference/loocv.html">loocv</a></span><span class="op">(</span><span class="va">poismod</span><span class="op">)</span></span>
<span><span class="co">#&gt; # A tibble: 1 × 3</span></span>
<span><span class="co">#&gt;    bias  MSPE RMSPE</span></span>
<span><span class="co">#&gt;   &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;</span></span>
<span><span class="co">#&gt; 1  1.35  32.1  5.67</span></span>
<span><span class="fu"><a href="https://usepa.github.io/spmodel/reference/loocv.html">loocv</a></span><span class="op">(</span><span class="va">nbmod</span><span class="op">)</span></span>
<span><span class="co">#&gt; # A tibble: 1 × 3</span></span>
<span><span class="co">#&gt;    bias  MSPE RMSPE</span></span>
<span><span class="co">#&gt;   &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;</span></span>
<span><span class="co">#&gt; 1 0.845  27.9  5.28</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><code>nbmod</code> has the lower <code><a href="https://usepa.github.io/spmodel/reference/loocv.html">loocv()</a></code> error, suggesting it is a better fit to the data.</p>
</div>
</div>
</div>
</section><section id="spatial-prediction" class="level2" data-number="3.3"><h2 data-number="3.3" class="anchored" data-anchor-id="spatial-prediction">
<span class="header-section-number">3.3</span> Spatial Prediction</h2>
<p>We can also make predictions of the mean function at unobserved locations. For example, we can use <code>poismod</code> to predict the mean number of moose (on the link scale) at the spatial locations in <code>moose_preds</code> using <code><a href="https://rdrr.io/r/stats/predict.html">predict()</a></code> by running:</p>
<div class="cell">
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># results omitted</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/stats/predict.html">predict</a></span><span class="op">(</span><span class="va">poismod</span>, newdata <span class="op">=</span> <span class="va">moose_preds</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>We can also use <code><a href="https://generics.r-lib.org/reference/augment.html">augment()</a></code>:</p>
<div class="cell">
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://generics.r-lib.org/reference/augment.html">augment</a></span><span class="op">(</span><span class="va">poismod</span>, newdata <span class="op">=</span> <span class="va">moose_preds</span><span class="op">)</span></span>
<span><span class="co">#&gt; Simple feature collection with 100 features and 3 fields</span></span>
<span><span class="co">#&gt; Geometry type: POINT</span></span>
<span><span class="co">#&gt; Dimension:     XY</span></span>
<span><span class="co">#&gt; Bounding box:  xmin: 269386.2 ymin: 1418453 xmax: 419976.2 ymax: 1541763</span></span>
<span><span class="co">#&gt; Projected CRS: NAD83 / Alaska Albers</span></span>
<span><span class="co">#&gt; # A tibble: 100 × 4</span></span>
<span><span class="co">#&gt;     elev strat .fitted           geometry</span></span>
<span><span class="co">#&gt;  * &lt;dbl&gt; &lt;chr&gt;   &lt;dbl&gt;        &lt;POINT [m]&gt;</span></span>
<span><span class="co">#&gt;  1  143. L      0.207  (401239.6 1436192)</span></span>
<span><span class="co">#&gt;  2  324. L     -0.0563 (352640.6 1490695)</span></span>
<span><span class="co">#&gt;  3  158. L     -1.24   (360954.9 1491590)</span></span>
<span><span class="co">#&gt;  4  221. M     -1.16   (291839.8 1466091)</span></span>
<span><span class="co">#&gt;  5  209. M      1.78   (310991.9 1441630)</span></span>
<span><span class="co">#&gt;  6  218. L     -1.84   (304473.8 1512103)</span></span>
<span><span class="co">#&gt;  7  127. L     -2.80   (339011.1 1459318)</span></span>
<span><span class="co">#&gt;  8  122. L     -2.45   (342827.3 1463452)</span></span>
<span><span class="co">#&gt;  9  191  L     -0.409  (284453.8 1502837)</span></span>
<span><span class="co">#&gt; 10  105. L     -1.10   (391343.9 1483791)</span></span>
<span><span class="co">#&gt; # ℹ 90 more rows</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>By default, <code><a href="https://rdrr.io/r/stats/predict.html">predict()</a></code> and <code><a href="https://generics.r-lib.org/reference/augment.html">augment()</a></code> return predictions on the link scale. We return predictions on the response scale by running</p>
<div class="cell">
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">augmod</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://generics.r-lib.org/reference/augment.html">augment</a></span><span class="op">(</span><span class="va">poismod</span>, newdata <span class="op">=</span> <span class="va">moose_preds</span>, type <span class="op">=</span> <span class="st">"response"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>And we can visualize these predictions by running</p>
<div class="cell">
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="va">augmod</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>color <span class="op">=</span> <span class="va">.fitted</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html">geom_sf</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_viridis.html">scale_color_viridis_c</a></span><span class="op">(</span>limits <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">40</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_gray</a></span><span class="op">(</span>base_size <span class="op">=</span> <span class="fl">14</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="spglm_files/figure-html/unnamed-chunk-8-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="callout-important callout callout-style-default no-icon callout-captioned">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
Exercise
</div>
</div>
<div class="callout-body-container callout-body">
<p>Use <code><a href="https://usepa.github.io/spmodel/reference/spglm.html">spglm()</a></code> to fit a spatial logistic regression model to the <code>moose</code> data using <code>presence</code> as the response variable and a Cauchy covariance function. Then, find the predicted probabilities that moose are present at the spatial locations in <code>moose_preds</code> (Hint: Use the <code>type</code> argument in <code><a href="https://rdrr.io/r/stats/predict.html">predict()</a></code> or <code><a href="https://generics.r-lib.org/reference/augment.html">augment()</a></code>).</p>
</div>
</div>
<div class="callout-important callout callout-style-default no-icon callout-captioned">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-5-contents" aria-controls="callout-5" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
Exercise Solution
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-5" class="callout-5-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<div class="cell">
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">binmod</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://usepa.github.io/spmodel/reference/spglm.html">spglm</a></span><span class="op">(</span><span class="va">presence</span> <span class="op">~</span> <span class="va">elev</span> <span class="op">*</span> <span class="va">strat</span>, data <span class="op">=</span> <span class="va">moose</span>,</span>
<span>               family <span class="op">=</span> <span class="va">binomial</span>, spcov_type <span class="op">=</span> <span class="st">"cauchy"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://generics.r-lib.org/reference/augment.html">augment</a></span><span class="op">(</span><span class="va">binmod</span>, newdata <span class="op">=</span> <span class="va">moose_preds</span>, type <span class="op">=</span> <span class="st">"response"</span><span class="op">)</span></span>
<span><span class="co">#&gt; Simple feature collection with 100 features and 3 fields</span></span>
<span><span class="co">#&gt; Geometry type: POINT</span></span>
<span><span class="co">#&gt; Dimension:     XY</span></span>
<span><span class="co">#&gt; Bounding box:  xmin: 269386.2 ymin: 1418453 xmax: 419976.2 ymax: 1541763</span></span>
<span><span class="co">#&gt; Projected CRS: NAD83 / Alaska Albers</span></span>
<span><span class="co">#&gt; # A tibble: 100 × 4</span></span>
<span><span class="co">#&gt;     elev strat .fitted           geometry</span></span>
<span><span class="co">#&gt;  * &lt;dbl&gt; &lt;chr&gt;   &lt;dbl&gt;        &lt;POINT [m]&gt;</span></span>
<span><span class="co">#&gt;  1  143. L      0.489  (401239.6 1436192)</span></span>
<span><span class="co">#&gt;  2  324. L      0.376  (352640.6 1490695)</span></span>
<span><span class="co">#&gt;  3  158. L      0.0945 (360954.9 1491590)</span></span>
<span><span class="co">#&gt;  4  221. M      0.229  (291839.8 1466091)</span></span>
<span><span class="co">#&gt;  5  209. M      0.804  (310991.9 1441630)</span></span>
<span><span class="co">#&gt;  6  218. L      0.0411 (304473.8 1512103)</span></span>
<span><span class="co">#&gt;  7  127. L      0.0234 (339011.1 1459318)</span></span>
<span><span class="co">#&gt;  8  122. L      0.0432 (342827.3 1463452)</span></span>
<span><span class="co">#&gt;  9  191  L      0.391  (284453.8 1502837)</span></span>
<span><span class="co">#&gt; 10  105. L      0.197  (391343.9 1483791)</span></span>
<span><span class="co">#&gt; # ℹ 90 more rows</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
</div>
</div>
</section><section id="additional-spmodel-features" class="level2" data-number="3.4"><h2 data-number="3.4" class="anchored" data-anchor-id="additional-spmodel-features">
<span class="header-section-number">3.4</span> Additional <code>spmodel</code> Features</h2>
<p>All advanced features available in <code>spmodel</code> for spatial linear models are also available for spatial generalized linear models. This means that spatial generalized linear models in <code>spmodel</code> can accommodate big spatial data (though far less than in the spatial linear model case), fixing spatial covariance parameters, fitting and predicting for multiple models, non-spatial random effects (on the link scale), partition factors, anisotropy (on the link scale), and prediction. <code>spmodel</code> has a variety of additional simulation functions used to simulate binary, proportion, count, and skewed data:</p>
<ul>
<li>Binary data: <code><a href="https://usepa.github.io/spmodel/reference/sprbinom.html">sprbinom()</a></code>
</li>
<li>Proportion data: <code><a href="https://usepa.github.io/spmodel/reference/sprbeta.html">sprbeta()</a></code>
</li>
<li>Count data: <code><a href="https://usepa.github.io/spmodel/reference/sprpois.html">sprpois()</a></code> and <code><a href="https://usepa.github.io/spmodel/reference/sprnbinom.html">sprnbinom()</a></code>
</li>
<li>Skewed data: <code><a href="https://usepa.github.io/spmodel/reference/sprgamma.html">sprgamma()</a></code> and <code><a href="https://usepa.github.io/spmodel/reference/sprinvgauss.html">sprinvgauss()</a></code>
</li>
</ul>
<p>With these simulation functions, the spatial covariance parameters and mean vector are specified on the appropriate link scale. For <code><a href="https://usepa.github.io/spmodel/reference/sprbinom.html">sprbinom()</a></code> and <code><a href="https://usepa.github.io/spmodel/reference/sprbeta.html">sprbeta()</a></code>, this is the logit link scale. For the other functions, this is the log link scale. We simulate one realization of Poisson data where on the link scale, the mean is zero and the spatial covariance structure is specified via <code>params</code>, by running</p>
<div class="cell">
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">params</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://usepa.github.io/spmodel/reference/spcov_params.html">spcov_params</a></span><span class="op">(</span><span class="st">"exponential"</span>, de <span class="op">=</span> <span class="fl">1</span>, ie <span class="op">=</span> <span class="fl">0.5</span>, range <span class="op">=</span> <span class="fl">5e5</span><span class="op">)</span></span>
<span><span class="va">sulfate</span><span class="op">$</span><span class="va">p</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://usepa.github.io/spmodel/reference/sprpois.html">sprpois</a></span><span class="op">(</span><span class="va">params</span>, data <span class="op">=</span> <span class="va">sulfate</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>We visualize this realization by running</p>
<div class="cell">
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="va">sulfate</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>color <span class="op">=</span> <span class="va">p</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html">geom_sf</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_viridis.html">scale_color_viridis_c</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_gray</a></span><span class="op">(</span>base_size <span class="op">=</span> <span class="fl">14</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="spglm_files/figure-html/unnamed-chunk-11-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section><section id="spatial-generalized-autoregressive-mdoels" class="level2" data-number="3.5"><h2 data-number="3.5" class="anchored" data-anchor-id="spatial-generalized-autoregressive-mdoels">
<span class="header-section-number">3.5</span> Spatial Generalized Autoregressive Mdoels</h2>
<p>So far we discussed how to formulate spatial generalized linear models using <code><a href="https://usepa.github.io/spmodel/reference/spglm.html">spglm()</a></code>, building off the construction of spatial linear models fit using <code><a href="https://usepa.github.io/spmodel/reference/splm.html">splm()</a></code>. Similarly, we can formulate spatial generalized autoregressive models using <code><a href="https://usepa.github.io/spmodel/reference/spgautor.html">spgautor()</a></code>, building off the construction of spatial autoregressive models fit using <code><a href="https://usepa.github.io/spmodel/reference/spautor.html">spautor()</a></code>. Spatial generalized autoregressive models can be fit to binomial, proportion, count, and skewed data by providing the <code>family</code> argument, as with the models fit using <code><a href="https://usepa.github.io/spmodel/reference/splm.html">splm()</a></code>. For example, we model <code>exp(log_trend)</code> (which is strictly positive) as a gamma random variable with the simultaneous autoregressive spatial covariance by running</p>
<div class="cell">
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">sealgmod</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://usepa.github.io/spmodel/reference/spgautor.html">spgautor</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html">exp</a></span><span class="op">(</span><span class="va">log_trend</span><span class="op">)</span> <span class="op">~</span> <span class="fl">1</span>, family <span class="op">=</span> <span class="va">Gamma</span>,</span>
<span>                  data <span class="op">=</span> <span class="va">seal</span>, spcov_type <span class="op">=</span> <span class="st">"sar"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">sealgmod</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Call:</span></span>
<span><span class="co">#&gt; spgautor(formula = exp(log_trend) ~ 1, family = Gamma, data = seal, </span></span>
<span><span class="co">#&gt;     spcov_type = "sar")</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Deviance Residuals:</span></span>
<span><span class="co">#&gt;      Min       1Q   Median       3Q      Max </span></span>
<span><span class="co">#&gt; -0.31970 -0.10003  0.04354  0.07266  0.20661 </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Coefficients (fixed):</span></span>
<span><span class="co">#&gt;             Estimate Std. Error z value Pr(&gt;|z|)   </span></span>
<span><span class="co">#&gt; (Intercept) -0.07106    0.02203  -3.226  0.00126 **</span></span>
<span><span class="co">#&gt; ---</span></span>
<span><span class="co">#&gt; Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Coefficients (sar spatial covariance):</span></span>
<span><span class="co">#&gt;        de     range     extra </span></span>
<span><span class="co">#&gt; 3.783e-04 2.164e-03 4.106e-05 </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Coefficients (Dispersion for Gamma family):</span></span>
<span><span class="co">#&gt; dispersion </span></span>
<span><span class="co">#&gt;      61.89</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section><section id="r-code-appendix" class="level2" data-number="3.6"><h2 data-number="3.6" class="anchored" data-anchor-id="r-code-appendix">
<span class="header-section-number">3.6</span> R Code Appendix</h2>
<div class="cell">

</div>
<div class="cell">
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://usepa.github.io/spmodel/">spmodel</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org">ggplot2</a></span><span class="op">)</span></span>
<span><span class="va">poismod</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://usepa.github.io/spmodel/reference/spglm.html">spglm</a></span><span class="op">(</span><span class="va">count</span> <span class="op">~</span> <span class="va">elev</span> <span class="op">*</span> <span class="va">strat</span>, data <span class="op">=</span> <span class="va">moose</span>,</span>
<span>               family <span class="op">=</span> <span class="va">poisson</span>, spcov_type <span class="op">=</span> <span class="st">"spherical"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">poismod</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://generics.r-lib.org/reference/glance.html">glance</a></span><span class="op">(</span><span class="va">poismod</span><span class="op">)</span></span>
<span><span class="va">nbmod</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://usepa.github.io/spmodel/reference/spglm.html">spglm</a></span><span class="op">(</span><span class="va">count</span> <span class="op">~</span> <span class="va">elev</span> <span class="op">*</span> <span class="va">strat</span>, data <span class="op">=</span> <span class="va">moose</span>,</span>
<span>               family <span class="op">=</span> <span class="va">nbinomial</span>, spcov_type <span class="op">=</span> <span class="st">"spherical"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://usepa.github.io/spmodel/reference/loocv.html">loocv</a></span><span class="op">(</span><span class="va">poismod</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://usepa.github.io/spmodel/reference/loocv.html">loocv</a></span><span class="op">(</span><span class="va">nbmod</span><span class="op">)</span></span>
<span><span class="co"># results omitted</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/stats/predict.html">predict</a></span><span class="op">(</span><span class="va">poismod</span>, newdata <span class="op">=</span> <span class="va">moose_preds</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://generics.r-lib.org/reference/augment.html">augment</a></span><span class="op">(</span><span class="va">poismod</span>, newdata <span class="op">=</span> <span class="va">moose_preds</span><span class="op">)</span></span>
<span><span class="va">augmod</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://generics.r-lib.org/reference/augment.html">augment</a></span><span class="op">(</span><span class="va">poismod</span>, newdata <span class="op">=</span> <span class="va">moose_preds</span>, type <span class="op">=</span> <span class="st">"response"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="va">augmod</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>color <span class="op">=</span> <span class="va">.fitted</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html">geom_sf</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_viridis.html">scale_color_viridis_c</a></span><span class="op">(</span>limits <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">40</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_gray</a></span><span class="op">(</span>base_size <span class="op">=</span> <span class="fl">14</span><span class="op">)</span></span>
<span><span class="va">binmod</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://usepa.github.io/spmodel/reference/spglm.html">spglm</a></span><span class="op">(</span><span class="va">presence</span> <span class="op">~</span> <span class="va">elev</span> <span class="op">*</span> <span class="va">strat</span>, data <span class="op">=</span> <span class="va">moose</span>,</span>
<span>               family <span class="op">=</span> <span class="va">binomial</span>, spcov_type <span class="op">=</span> <span class="st">"cauchy"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://generics.r-lib.org/reference/augment.html">augment</a></span><span class="op">(</span><span class="va">binmod</span>, newdata <span class="op">=</span> <span class="va">moose_preds</span>, type <span class="op">=</span> <span class="st">"response"</span><span class="op">)</span></span>
<span><span class="va">params</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://usepa.github.io/spmodel/reference/spcov_params.html">spcov_params</a></span><span class="op">(</span><span class="st">"exponential"</span>, de <span class="op">=</span> <span class="fl">1</span>, ie <span class="op">=</span> <span class="fl">0.5</span>, range <span class="op">=</span> <span class="fl">5e5</span><span class="op">)</span></span>
<span><span class="va">sulfate</span><span class="op">$</span><span class="va">p</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://usepa.github.io/spmodel/reference/sprpois.html">sprpois</a></span><span class="op">(</span><span class="va">params</span>, data <span class="op">=</span> <span class="va">sulfate</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="va">sulfate</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>color <span class="op">=</span> <span class="va">p</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html">geom_sf</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_viridis.html">scale_color_viridis_c</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_gray</a></span><span class="op">(</span>base_size <span class="op">=</span> <span class="fl">14</span><span class="op">)</span></span>
<span><span class="va">sealgmod</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://usepa.github.io/spmodel/reference/spgautor.html">spgautor</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html">exp</a></span><span class="op">(</span><span class="va">log_trend</span><span class="op">)</span> <span class="op">~</span> <span class="fl">1</span>, family <span class="op">=</span> <span class="va">Gamma</span>,</span>
<span>                  data <span class="op">=</span> <span class="va">seal</span>, spcov_type <span class="op">=</span> <span class="st">"sar"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">sealgmod</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>


<div id="refs" class="references csl-bib-body hanging-indent" role="doc-bibliography" style="display: none">
<div id="ref-hoef2023marginal" class="csl-entry" role="doc-biblioentry">
Ver Hoef, Jay M, Eryn Blagg, Michael Dumelle, Philip M Dixon, Dale L Zimmerman, and Paul Conn. 2023. <span>“Marginal Inference for Hierarchical Generalized Linear Mixed Models with Patterned Covariance Matrices Using the Laplace Approximation.”</span> <em>arXiv Preprint arXiv:2305.02978</em>.
</div>
</div>
</section></main><!-- /main --><script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    target: function(trigger) {
      return trigger.previousElementSibling;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script><nav class="page-navigation"><div class="nav-page nav-page-previous">
      <a href="./splm-additional.html" class="pagination-link">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Additional <code>spmodel</code> Features</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="./gis-in-r.html" class="pagination-link">
        <span class="nav-page-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">GIS in R</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->
<footer class="footer"><div class="nav-footer">
    <div class="nav-footer-left">Workshop materials created by Michael Dumelle and Ryan Hill</div>   
    <div class="nav-footer-right">This book was built with <a href="https://quarto.org/">Quarto</a>.</div>
  </div>
</footer>


</body></html>